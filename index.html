<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <!-- ダブルタップ・ピンチズームをすべて無効化 -->
  <meta name="viewport"
        content="width=device-width,
                 initial-scale=1.0,
                 maximum-scale=1.0,
                 user-scalable=no">

  <title>焼き鳥クイズ</title>

  <style>
    /* ===== 全ページ共通 ===== */
    html,body{
      margin:0;padding:0;
      /* iOS / Android どちらでもダブルタップズームを抑止 */
      touch-action: manipulation;          /* Chrome / Edge / Android */
      -ms-touch-action: manipulation;      /* 旧 Edge */
      -webkit-user-select:none;            /* iOS Safari 選択禁止 */
      user-select:none;
      -webkit-tap-highlight-color:transparent;
      background:#fffaf0;
      font-family:Arial, sans-serif;
      text-align:center;
    }

    /* ===== 基本レイアウト ===== */
    .screen{
      position:fixed;inset:0;
      display:none;flex-direction:column;
      justify-content:center;align-items:center;
    }
    .screen.active{display:flex;}

    h1{font-size:28px;margin:0 0 20px;color:#000;}
    /* スタート画面ボタン */
    #startScreen button{
      margin:8px 0;padding:14px 22px;
      font-size:20px;color:#fff;
      background:#d2691e;border:none;border-radius:10px;
      cursor:pointer;white-space:nowrap;
      touch-action:manipulation;
    }
    #startScreen button:active{background:#a0522d;transform:scale(.96);}

    /* ===== クイズ画面 ===== */
    #progress{font-size:18px;color:#8b4513;margin-bottom:4px;}
    #question{font-size:22px;font-weight:bold;margin-bottom:10px;}
    #timer{font-size:26px;color:#d2691e;margin-bottom:8px;font-weight:bold;}

    #display{
      width:120px;margin:10px auto 14px;
      padding:8px 0;font-size:26px;
      border:2px solid #8b4513;border-radius:10px;
      background:#fff;
    }

    .control-buttons{
      display:grid;grid-template-columns:1fr 1fr;gap:12px;
      width:260px;margin:0 auto 14px;
    }
    .control-buttons button{
      padding:20px;font-size:20px;
      background:#d2691e;color:#fff;border:none;border-radius:10px;
      cursor:pointer;touch-action:manipulation;
    }
    .control-buttons button:active{background:#a0522d;transform:scale(.96);}

    .numpad{
      display:grid;grid-template-columns:repeat(3,1fr);gap:12px;
      width:240px;margin:0 auto;
    }
    .numpad button{
      padding:18px;font-size:20px;
      background:#d2691e;color:#fff;border:none;border-radius:10px;
      cursor:pointer;touch-action:manipulation;
      aspect-ratio:1/1;           /* 正方形 */
    }
    /* 0 だけ横長 */
    .numpad button.zero{grid-column:span 3;aspect-ratio:auto;}

    .numpad button:active{background:#a0522d;transform:scale(.96);}

    /* ===== 終了画面 ===== */
    #scoreText{margin:14px 0;font-size:18px;line-height:1.6;}
  </style>
</head>
<body>
  <!-- スタート画面 -->
  <div id="startScreen" class="screen active">
    <h1>焼き鳥クイズ</h1>
    <button onclick="startGame('all')">全問チャレンジ</button>
    <button onclick="startGame('15')">15問チャレンジ</button>
  </div>

  <!-- クイズ画面 -->
  <div id="quizScreen" class="screen">
    <div id="progress"></div>
    <div id="question"></div>
    <div id="timer">10</div>
    <div id="display">0</div>

    <div class="control-buttons">
      <button onclick="clearAnswer()">クリア</button>
      <button onclick="checkAnswer()">解答</button>
    </div>

    <div class="numpad">
      <button onclick="addNumber(7)">7</button>
      <button onclick="addNumber(8)">8</button>
      <button onclick="addNumber(9)">9</button>
      <button onclick="addNumber(4)">4</button>
      <button onclick="addNumber(5)">5</button>
      <button onclick="addNumber(6)">6</button>
      <button onclick="addNumber(1)">1</button>
      <button onclick="addNumber(2)">2</button>
      <button onclick="addNumber(3)">3</button>
      <button class="zero" onclick="addNumber(0)">0</button>
    </div>
  </div>

  <!-- 終了画面 -->
  <div id="endScreen" class="screen">
    <h1>クイズ終了！</h1>
    <p id="scoreText"></p>
    <button onclick="returnToStart()">スタート画面に戻る</button>
  </div>

  <script>
    /* ==== ズーム完全ブロック用リスナー ==== */
    // 2本指以上のタッチでピンチ開始を阻止
    document.addEventListener('touchstart',e=>{
      if(e.touches.length>1){e.preventDefault();}
    },{passive:false});
    // 300ms以内のダブルタップを阻止
    let lastTouchEnd=0;
    document.addEventListener('touchend',e=>{
      const now=Date.now();
      if(now-lastTouchEnd<=300){e.preventDefault();}
      lastTouchEnd=now;
    },{passive:false});
    // dblclick が発火する環境でもズーム阻止
    document.addEventListener('dblclick',e=>e.preventDefault(),{passive:false});

    /* ==== クイズロジック ==== */
    const yakitoriMenu={
      "ねぎま（しお・タレ）":160,"つくね（しお・タレ）":200,"せせり":160,"肝（ねぎごま油・タレ）":200,
      "軍鶏むね":400,"軍鶏もも":400,"とりかわ（しお・タレ）":120,"ぼんじり":180,"チーズベーコン":350,
      "ウィンナー":220,"えびしそ":160,"親もも":160,"ハツ":180,"砂ずり":160,"豚肩ロース":300,
      "しいたけ":220,"ししゃも":140,"ピーマン肉詰め":180,"うずらベーコン":220,"しそ豚":220,
      "えのき巻":200,"ニラ巻":200,"ねぎハラミ":400,"鳥賊のくちばし":220,"ハツモト":280,"軍鶏かわ":280,
      "いかだ（酢みそ・タレ）":180,"なんこつ":180,"アスパラ巻":220,"じゃこ天串":160,"トマト巻":200,
      "れんこん肉詰め":250,"和牛ホルモン":330,"ささみ":200
    };

    let mode,total,menuItems,used,currentQ,currentA,score,timer,tl,interval,wrong=[];
    const qs=document;

    function startGame(m){
      mode=m;total=(m==='15'?15:Object.keys(yakitoriMenu).length);
      menuItems=Object.keys(yakitoriMenu);used=[];score=0;wrong=[];
      qs.getElementById('startScreen').classList.remove('active');
      qs.getElementById('endScreen').classList.remove('active');
      qs.getElementById('quizScreen').classList.add('active');
      nextQ();
    }

    function nextQ(){
      clearInterval(interval);
      if(used.length===total){endGame();return;}
      do{currentQ=menuItems[Math.floor(Math.random()*menuItems.length)];}
      while(used.includes(currentQ));
      used.push(currentQ);
      qs.getElementById('question').textContent=`${currentQ} の値段は？`;
      qs.getElementById('progress').textContent=`${used.length}/${total}問目`;
      currentA='0';qs.getElementById('display').textContent='0';
      startTimer();
    }

    function addNumber(n){
      if(currentA==='0')currentA=''+n;
      else if(currentA.length<4)currentA+=n;
      qs.getElementById('display').textContent=currentA;
    }

    function clearAnswer(){currentA='0';qs.getElementById('display').textContent='0';}

    function checkAnswer(){
      clearInterval(interval);
      const ans=yakitoriMenu[currentQ];
      if(parseInt(currentA)===ans)score++;
      else wrong.push(`${currentQ}：正解 ${ans} 円`);
      setTimeout(nextQ,600);
    }

    function startTimer(){
      tl=10;const el=qs.getElementById('timer');el.textContent=tl;
      interval=setInterval(()=>{
        tl--;el.textContent=tl;
        if(tl===0){clearInterval(interval);wrong.push(`${currentQ}：タイムアウト`);setTimeout(nextQ,600);}
      },1000);
    }

    function endGame(){
      clearInterval(interval);
      const txt=`${total}問中${score}問正解！<br><br>${wrong.length?
        '<strong>間違えた問題</strong><br>'+wrong.join('<br>'):'全問正解！'}`;
      qs.getElementById('scoreText').innerHTML=txt;
      qs.getElementById('quizScreen').classList.remove('active');
      qs.getElementById('endScreen').classList.add('active');
    }

    function returnToStart(){
      qs.getElementById('endScreen').classList.remove('active');
      qs.getElementById('startScreen').classList.add('active');
    }
  </script>
</body>
</html>
