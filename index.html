<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <title>お値段クイズ</title>
  <link href="https://fonts.googleapis.com/css2?family=Kaisei+Tokumin:wght@700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Kosugi+Maru&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho+B1:wght@700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Yuji+Boku&display=swap" rel="stylesheet">
  <style>
    html,body{
      margin:0;padding:0;
      touch-action:manipulation;
      -webkit-user-select:none;
      user-select:none;
      -webkit-tap-highlight-color:transparent;
      background:#fffaf0;
      text-align:center;
      font-family:'Yuji Boku','Shippori Mincho B1','Kaisei Tokumin','Kosugi Maru',serif;
      letter-spacing:0.05em;
    }

    .screen{position:fixed;inset:0;display:none;flex-direction:column;
      justify-content:center;align-items:center;}
    .screen.active{display:flex;}

    h1{font-size:34px;margin:0 0 28px;color:#000;font-family:inherit;}
    .menu-title{font-size:32px;font-family:inherit;margin-bottom:18px;}
    .mode-select{font-size:23px;margin:12px 0;}
    .select-btn {
      margin:14px 0;
      padding:24px 0;
      width:200px;
      font-size:27px;
      color:#fff;
      background:#d2691e;
      border:none;
      border-radius:18px;
      cursor:pointer;
      font-family:inherit;
      box-shadow:0 3px 8px #0002;
    }
    .select-btn:active{background:#a0522d;transform:scale(.96);}
    #startScreen .select-btn{width:220px;}

    /* クイズ画面 */
    #progress{font-size:22px;color:#8b4513;margin-bottom:4px;font-family:inherit;}
    #progress-now{font-size:23px;font-weight:bold;margin-bottom:10px;font-family:inherit;color:#8b4513;}
    #question{font-size:25px;font-weight:bold;margin-bottom:14px;font-family:inherit;}
    #timer{font-size:30px;color:#d2691e;margin-bottom:8px;font-weight:bold;}
    #result{min-height:40px;font-size:25px;font-weight:bold;margin-bottom:12px;display:flex;justify-content:center;align-items:center;gap:8px;}
    .result-ok{color:#22c55e;}
    .result-ng{color:#ef4444;}
    .result-icon{font-size:32px;}
    #display{width:130px;margin:10px auto 18px;padding:11px 0;font-size:29px;border:2px solid #8b4513;border-radius:11px;background:#fff;}
    .control-buttons{display:grid;grid-template-columns:1fr 1fr;gap:14px;width:270px;margin:0 auto 18px;}
    .control-buttons button,
    .numpad button{padding:20px;font-size:23px;background:#d2691e;color:#fff;border:none;border-radius:11px;cursor:pointer;font-family:inherit;}
    .control-buttons button:active,
    .numpad button:active{background:#a0522d;transform:scale(.96);}
    .numpad{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;width:250px;margin:0 auto;}
    .numpad button{aspect-ratio:1/1;}
    .numpad button.zero{grid-column:span 3;aspect-ratio:auto;}

    #menuOverlay{position:absolute;inset:0;background:rgba(0,0,0,.5);display:none;justify-content:center;align-items:center;z-index:10;}
    #menuOverlay div{background:#fff;padding:22px 22px 18px;border-radius:14px;text-align:center;box-shadow:0 2px 10px #0004;}
    #menuOverlay button{margin:10px;padding:13px 26px;font-size:19px;color:#fff;background:#d2691e;border:none;border-radius:9px;font-family:inherit;}
    #menuOverlay button:active{background:#a0522d;}

    #endComment {
      font-size:2.1em;
      font-family:inherit;
      letter-spacing:0.08em;
      margin:0 0 22px 0;
      text-align:center;
      white-space:pre-line;
      word-break:keep-all;
      font-weight:bold;
      min-height:2.5em;
    }
    #wrongListBox {
      max-height:300px;
      overflow-y:auto;
      width:90vw;
      max-width:420px;
      margin:0 auto 28px auto;
      border-radius:14px;
      background:#fffef7;
      box-shadow:0 2px 12px #0002;
      padding:22px 18px;
      font-family:inherit;
      font-size:1.15em;
      border:1.5px solid #e1c59b;
      text-align:left;
      line-height:1.7;
    }
    #wrongList strong {
      font-size:1.13em;
      color:#d2691e;
      display:block;
      margin-bottom:7px;
      font-family:inherit;
    }
    #endScreen button{padding:14px 22px;font-size:22px;color:#fff;background:#d2691e;border:none;border-radius:11px;cursor:pointer;font-family:inherit;}
    #endScreen button:active{background:#a0522d;transform:scale(.96);}
  </style>
</head>
<body>
  <!-- スタート画面 -->
  <div id="startScreen" class="screen active">
    <h1 class="menu-title">お値段クイズ</h1>
    <button class="select-btn" onclick="selectCategory('yakitori')">焼鳥</button><br>
    <button class="select-btn" onclick="selectCategory('otsumami')">おつまみ</button><br>
    <button class="select-btn" onclick="selectCategory('drink')">ドリンク</button>
  </div>
  <!-- モード選択画面 -->
  <div id="modeScreen" class="screen">
    <div class="mode-select">全問チャレンジ or 15問チャレンジ</div>
    <button class="select-btn" onclick="startGame('all')">全問チャレンジ</button><br>
    <button class="select-btn" onclick="startGame('15')">15問チャレンジ</button><br>
    <button class="select-btn" onclick="returnToStart()">戻る</button>
  </div>

  <!-- クイズ画面 -->
  <div id="quizScreen" class="screen">
    <!-- メニューボタン -->
    <button onclick="openMenu()" style="position:absolute;top:10px;right:10px;background:none;border:none;font-size:32px;color:#8b4513;">☰</button>
    <!-- ここ追加 -->
    <div id="progress-now"></div>
    <div id="progress"></div>
    <div id="question"></div>
    <div id="timer">10</div>
    <div id="result"></div>
    <div id="display">0</div>
    <div class="control-buttons">
      <button id="clearBtn" onclick="clearAnswer()">クリア</button>
      <button id="answerBtn" onclick="checkAnswer()">解答</button>
    </div>
    <div class="numpad">
      <button onclick="addNumber(7)">7</button><button onclick="addNumber(8)">8</button><button onclick="addNumber(9)">9</button>
      <button onclick="addNumber(4)">4</button><button onclick="addNumber(5)">5</button><button onclick="addNumber(6)">6</button>
      <button onclick="addNumber(1)">1</button><button onclick="addNumber(2)">2</button><button onclick="addNumber(3)">3</button>
      <button class="zero" onclick="addNumber(0)">0</button>
    </div>
    <!-- メニューオーバーレイ -->
    <div id="menuOverlay">
      <div>
        <button onclick="returnToStart()">スタート画面に戻る</button><br>
        <button onclick="closeMenu()">続ける</button><br>
        <button onclick="endGameEarly()">終わる</button>
      </div>
    </div>
  </div>
  <!-- エンド画面 -->
  <div id="endScreen" class="screen">
    <div id="endComment"></div>
    <div id="wrongListBox">
      <div id="wrongList"></div>
    </div>
    <button onclick="returnToStart()">スタート画面に戻る</button>
  </div>

  <script>
    const menus = {
      yakitori: {
        "ねぎま":160,"つくね":200,"せせり":160,"肝":200,
        "軍鶏むね":400,"軍鶏もも":400,"とりかわ":120,"ぼんじり":180,"チーズベーコン":350,
        "ウィンナー":220,"えびしそ":160,"親もも":160,"ハツ":180,"砂ずり":160,"豚肩ロース":300,
        "しいたけ":220,"ししゃも":140,"ピーマン肉詰め":180,"うずらベーコン":220,"しそ豚":220,
        "えのき巻":200,"ニラ巻":200,"ねぎハラミ":400,"鳥賊のくちばし":220,"ハツモト":280,"軍鶏かわ":280,
        "いかだ":180,"なんこつ":180,"アスパラ巻":220,"じゃこ天串":160,"トマト巻":200,
        "れんこん肉詰め":250,"和牛ホルモン":330,"ささみ":200
      },
      otsumami: {
        "ちくわきゅうり": 550,
        "はるまき": 680,
        "せんまい": 700
      },
      drink: {
        "生ビール": 600,
        "ハイボール": 500,
        "サワー": 450
      }
    };

    let selectedCategory = 'yakitori', menuData, mode, total, items, used, q, current='0', score, timerID, timeLeft, wrong=[];
    let canAnswer = true; // ← 解答ボタンの多重タップ防止用

    // 要素取得
    const qs = document,
          startScr = qs.getElementById('startScreen'),
          modeScr = qs.getElementById('modeScreen'),
          quizScr = qs.getElementById('quizScreen'),
          endScr = qs.getElementById('endScreen'),
          pro = qs.getElementById('progress'),
          que = qs.getElementById('question'),
          tim = qs.getElementById('timer'),
          dis = qs.getElementById('display'),
          res = qs.getElementById('result'),
          scoreTxt = qs.getElementById('wrongList'),
          endComment = qs.getElementById('endComment'),
          menuOvl = qs.getElementById('menuOverlay'),
          wrongListBox = qs.getElementById('wrongListBox'),
          progressNow = qs.getElementById('progress-now'),
          answerBtn = qs.getElementById('answerBtn');

    function selectCategory(cat){
      selectedCategory = cat;
      startScr.classList.remove('active');
      modeScr.classList.add('active');
    }
    function startGame(m){
      menuData = menus[selectedCategory];
      mode = m;
      total = (m === '15') ? Math.min(15,Object.keys(menuData).length) : Object.keys(menuData).length;
      items = Object.keys(menuData);
      used = [];
      score = 0;
      wrong = [];
      modeScr.classList.remove('active');
      endScr.classList.remove('active');
      quizScr.classList.add('active');
      nextQuestion();
    }
    function nextQuestion(){
      canAnswer = true; // ← 解答ボタン有効化
      answerBtn.disabled = false;
      clearInterval(timerID);
      if(used.length === total){finish();return;}
      do{q = items[Math.floor(Math.random()*items.length)];}while(used.includes(q));
      used.push(q);
      // 「今何問中何問目か」表示
      progressNow.textContent = `${used.length}/${total}問目`;
      que.textContent = `${q} の値段は？`;
      pro.textContent = ""; // 古い表示方法は消す or 空に
      current='0';dis.textContent='0';res.textContent='';res.className='';
      startTimer();
    }
    function startTimer(){
      timeLeft=10;tim.textContent=timeLeft;
      timerID=setInterval(()=>{timeLeft--;tim.textContent=timeLeft;
        if(timeLeft===0){clearInterval(timerID);showResult(false,true,menuData[q]);}},1000);
    }
    function addNumber(n){if (!canAnswer) return; current=(current==='0')?''+n:(current.length<4?current+n:current);dis.textContent=current;}
    function clearAnswer(){if (!canAnswer) return; current='0';dis.textContent='0';}
    function checkAnswer(){
      if(!canAnswer) return; // ← 多重押し防止
      if(current==='0'){res.innerHTML='<span class="result-icon">✖</span>解答を入力してください';res.className='result-ng';return;}
      canAnswer = false; // 連打ロック
      answerBtn.disabled = true;
      clearInterval(timerID);
      const ans = menuData[q];
      if(parseInt(current)===ans){score++;showResult(true,false,ans);}
      else{wrong.push(`${q}：正解 ${ans} 円`);showResult(false,false,ans);}
    }
    function showResult(ok,timeout=false,ans=0){
      if(timeout){res.innerHTML=`<span class="result-icon">✖</span>時間切れ！ 正解は ${ans} 円です`;res.className='result-ng';wrong.push(`${q}：タイムアウト`);}
      else if(ok){res.innerHTML='<span class="result-icon">⭕</span>正解！';res.className='result-ok';}
      else{res.innerHTML=`<span class="result-icon">✖</span>不正解！ 正解は ${ans} 円です`;res.className='result-ng';}
      setTimeout(nextQuestion,900);
    }
    function openMenu(){menuOvl.style.display='flex';}
    function closeMenu(){menuOvl.style.display='none';}
    function endGameEarly(){clearInterval(timerID);finish();}
    function finish(){
      clearInterval(timerID);
      const answered = used.length;
      const rate     = answered ? (score / answered) * 100 : 0;
      let comment;
      if      (rate === 100) comment = '焼き鳥奉行！\nパーフェクト！';
      else if (rate >= 90)   comment = 'ベテラン焼き師！\nあと一歩！';
      else if (rate >= 70)   comment = '串打ち職人見習い！\nいい線いってる！';
      else if (rate >= 50)   comment = '焼き鳥好き\nレベルアップ中！';
      else if (rate >= 30)   comment = 'これからが修行の本番！';
      else                   comment = '修行あるのみ！\nまずはメニューを覚えよう';
      endComment.innerHTML = comment.replace(/\n/g,'<br>');
      let wrongStr = '';
      if(wrong.length) wrongStr = `<strong>間違えた問題</strong><br>${wrong.join('<br>')}`;
      else if(answered > 0 && score === answered) wrongStr = '<strong>全問正解！</strong>';
      else wrongStr = '';
      scoreTxt.innerHTML = `${total}問中${score}問正解！<br><br>${wrongStr}`;
      menuOvl.style.display = 'none';
      quizScr.classList.remove('active');
      endScr.classList.add('active');
      wrongListBox.scrollTop = 0;
    }
    function returnToStart(){
      menuOvl.style.display='none';
      quizScr.classList.remove('active');
      endScr.classList.remove('active');
      modeScr.classList.remove('active');
      startScr.classList.add('active');
    }
  </script>
</body>
</html>
